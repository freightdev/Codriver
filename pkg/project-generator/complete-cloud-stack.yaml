# Complete Cloud Service Stack Configuration
# For 3-laptop cluster running Firecracker, Nomad, SeaweedFS, Ollama

# ============================================================================
# INFRASTRUCTURE LAYER
# ============================================================================

infrastructure:
  nodes:
    laptop1:
      hostname: node1.yourcloud.local
      ip: 192.168.1.100
      specs:
        cpu: 20
        ram: 24GB
        storage: 1TB
        gpu: iGPU (12.5GB shared)
      role: compute-primary
      services:
        - nomad-server
        - nomad-client
        - consul-server
        - seaweedfs-volume
        - ollama-coder
        - firecracker-host

    laptop2:
      hostname: node2.yourcloud.local
      ip: 192.168.1.101
      specs:
        cpu: 22
        ram: 16GB
        storage: 1TB
        gpu: iGPU + NPU
      role: compute-secondary
      services:
        - nomad-server
        - nomad-client
        - consul-server
        - seaweedfs-volume
        - ollama-reviewer
        - firecracker-host

    laptop3:
      hostname: node3.yourcloud.local
      ip: 192.168.1.102
      specs:
        cpu: 8
        ram: 32GB
        storage: 1TB
        gpu: iGPU + GTX 1650 (4GB)
      role: ai-primary
      services:
        - nomad-server
        - nomad-client
        - consul-server
        - seaweedfs-master
        - ollama-architect
        - postgres-primary

# ============================================================================
# NOMAD CLUSTER CONFIGURATION
# ============================================================================

nomad:
  version: "1.7.0"

  server:
    enabled: true
    bootstrap_expect: 3
    encrypt: "your-gossip-key-here"

  client:
    enabled: true

    host_volume:
      seaweedfs:
        path: "/mnt/seaweedfs"
        read_only: false

      ollama:
        path: "/opt/ollama/models"
        read_only: false

    meta:
      node_class: "compute"

    reserved:
      cpu: 2000 # Reserve 2 cores for system
      memory: 2048 # Reserve 2GB for system

  telemetry:
    prometheus_metrics: true
    publish_allocation_metrics: true

# ============================================================================
# FIRECRACKER CONFIGURATION
# ============================================================================

firecracker:
  version: "1.6.0"

  jailer:
    enabled: true
    chroot_base_dir: "/srv/firecracker"

  vm_templates:
    micro:
      vcpu_count: 1
      mem_size_mib: 512
      pricing: "$5/month"

    small:
      vcpu_count: 1
      mem_size_mib: 1024
      pricing: "$8/month"

    medium:
      vcpu_count: 2
      mem_size_mib: 2048
      pricing: "$15/month"

    large:
      vcpu_count: 4
      mem_size_mib: 4096
      pricing: "$30/month"

  # Kernel and rootfs images
  kernel_image: "/opt/firecracker/vmlinux.bin"
  rootfs_base: "/opt/firecracker/rootfs/"

  # Network configuration
  network:
    tap_device: "tap0"
    subnet: "172.16.0.0/24"
    gateway: "172.16.0.1"

# ============================================================================
# SEAWEEDFS CONFIGURATION
# ============================================================================

seaweedfs:
  version: "3.60"

  master:
    node: laptop3
    port: 9333
    peers:
      - "192.168.1.100:9333"
      - "192.168.1.101:9333"
      - "192.168.1.102:9333"
    default_replication: "001" # 1 copy
    volume_size_limit_mb: 30000 # 30GB per volume

  volume:
    nodes:
      - host: laptop1
        port: 8080
        dir: "/mnt/seaweedfs/volume1"
        max_volumes: 10

      - host: laptop2
        port: 8080
        dir: "/mnt/seaweedfs/volume2"
        max_volumes: 10

      - host: laptop3
        port: 8080
        dir: "/mnt/seaweedfs/volume3"
        max_volumes: 10

  filer:
    port: 8888
    default_replication: "001"
    encryption: true

  s3:
    enabled: true
    port: 8333
    domain_name: "s3.yourcloud.com"
    bucket_quota_gb: 100 # Per bucket limit

# ============================================================================
# OLLAMA CLUSTER CONFIGURATION
# ============================================================================

ollama:
  architect:
    node: laptop3
    model: "qwen2.5-coder:32b"
    port: 11434
    context_window: 32768
    num_gpu: 1

  coder:
    node: laptop1
    model: "qwen2.5-coder:14b"
    port: 11434
    context_window: 32768
    num_gpu: 0 # CPU only

  reviewer:
    node: laptop2
    model: "qwen2.5-coder:7b"
    port: 11434
    context_window: 16384
    num_gpu: 0

# ============================================================================
# SERVICE OFFERINGS
# ============================================================================

services:
  # Primary Service: AI Code Generation
  codeforge:
    name: "CodeForge Cloud"
    description: "AI-powered project generator"

    tiers:
      free:
        price: 0
        projects_per_month: 1
        max_files: 20
        model: "qwen2.5-coder:7b"
        queue_priority: 3

      indie:
        price: 29
        projects_per_month: 10
        max_files: 50
        model: "qwen2.5-coder:14b"
        queue_priority: 2
        features:
          - private_projects
          - email_support
          - custom_templates

      pro:
        price: 99
        projects_per_month: -1 # unlimited
        max_files: 100
        model: "qwen2.5-coder:32b"
        queue_priority: 1
        features:
          - everything_in_indie
          - api_access
          - priority_support
          - dedicated_resources

      enterprise:
        price: 499
        projects_per_month: -1
        max_files: -1 # unlimited
        model: "custom"
        queue_priority: 0
        features:
          - everything_in_pro
          - white_label
          - sla_guarantee
          - dedicated_vm
          - custom_models
          - onprem_option

  # Compute Service
  compute:
    name: "Serverless Functions & VMs"

    plans:
      micro_vm:
        vcpu: 1
        ram_gb: 0.5
        storage_gb: 10
        price: 5

      small_vm:
        vcpu: 1
        ram_gb: 1
        storage_gb: 20
        price: 8

      medium_vm:
        vcpu: 2
        ram_gb: 2
        storage_gb: 40
        price: 15

      large_vm:
        vcpu: 4
        ram_gb: 4
        storage_gb: 80
        price: 30

    functions:
      price_per_million_requests: 0.20
      included_requests: 1000000
      memory_options: [128, 256, 512, 1024]
      max_duration_seconds: 300

  # Storage Service
  storage:
    name: "Object Storage (S3-compatible)"

    plans:
      starter:
        storage_gb: 100
        bandwidth_gb: 100
        price: 5

      growth:
        storage_gb: 500
        bandwidth_gb: 500
        price: 20

      business:
        storage_gb: 1000
        bandwidth_gb: 1000
        price: 35

    features:
      - s3_compatible_api
      - cdn_integration
      - versioning
      - lifecycle_policies
      - encryption_at_rest

  # Database Service
  database:
    name: "Managed Databases"

    offerings:
      postgres:
        versions: ["14", "15", "16"]
        plans:
          small:
            vcpu: 1
            ram_gb: 1
            storage_gb: 20
            price: 15
          medium:
            vcpu: 2
            ram_gb: 2
            storage_gb: 40
            price: 30

      redis:
        versions: ["7.0", "7.2"]
        plans:
          small:
            ram_gb: 0.5
            price: 10
          medium:
            ram_gb: 2
            price: 25

      mongodb:
        versions: ["6.0", "7.0"]
        plans:
          small:
            vcpu: 1
            ram_gb: 2
            storage_gb: 20
            price: 20

  # CI/CD Service
  cicd:
    name: "CI/CD Runners"

    plans:
      hobby:
        concurrent_jobs: 1
        minutes_per_month: 500
        price: 10

      team:
        concurrent_jobs: 3
        minutes_per_month: 2000
        price: 25

      business:
        concurrent_jobs: 10
        minutes_per_month: 10000
        price: 75

    features:
      - docker_support
      - custom_environments
      - artifact_caching
      - github_gitlab_integration

# ============================================================================
# BILLING & METERING
# ============================================================================

billing:
  currency: "USD"
  billing_cycle: "monthly"

  payment_methods:
    - stripe
    - paypal
    - crypto # Optional

  metering:
    compute:
      metric: "vcpu-hours"
      granularity: "hourly"

    storage:
      metric: "gb-stored"
      granularity: "daily"

    bandwidth:
      metric: "gb-transferred"
      granularity: "hourly"

    api_calls:
      metric: "requests"
      granularity: "minute"

  quotas:
    free_tier:
      api_calls_per_day: 100
      storage_gb: 1
      bandwidth_gb: 10

    indie_tier:
      api_calls_per_day: 1000
      storage_gb: 100
      bandwidth_gb: 100

    pro_tier:
      api_calls_per_day: 10000
      storage_gb: 500
      bandwidth_gb: 1000

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

monitoring:
  prometheus:
    enabled: true
    retention: "30d"
    scrape_interval: "15s"

  grafana:
    enabled: true
    dashboards:
      - cluster_overview
      - vm_metrics
      - storage_metrics
      - ollama_performance
      - billing_metrics

  loki:
    enabled: true
    retention: "14d"

  alertmanager:
    enabled: true
    routes:
      - receiver: email
      - receiver: slack
      - receiver: pagerduty # For enterprise

# ============================================================================
# SECURITY
# ============================================================================

security:
  firewall:
    allow_ports:
      - 80 # HTTP
      - 443 # HTTPS
      - 22 # SSH (restricted)
      - 9333 # SeaweedFS master
      - 8080 # SeaweedFS volume
      - 11434 # Ollama

    deny_all_else: true

  ssl:
    provider: "letsencrypt"
    auto_renewal: true

  authentication:
    methods:
      - api_key
      - jwt
      - oauth2

    mfa_required: true

  isolation:
    vm_isolation: "firecracker"
    network_isolation: true
    storage_encryption: true

  compliance:
    data_residency: "on-premise"
    gdpr_compliant: true
    backup_retention: "30d"

# ============================================================================
# BACKUP & DISASTER RECOVERY
# ============================================================================

backup:
  strategy: "3-2-1" # 3 copies, 2 media, 1 offsite

  seaweedfs:
    enabled: true
    schedule: "0 2 * * *" # 2 AM daily
    retention: 30 # days
    destination: "external-drive"

  databases:
    enabled: true
    schedule: "0 */6 * * *" # Every 6 hours
    retention: 7 # days
    destination: "seaweedfs"

  vm_snapshots:
    enabled: true
    schedule: "0 0 * * 0" # Weekly on Sunday
    retention: 4 # weeks

# ============================================================================
# DEPLOYMENT AUTOMATION
# ============================================================================

deployment:
  provisioning:
    tool: "terraform"
    provider: "custom" # Your laptops

  configuration:
    tool: "ansible"
    inventory: "inventory/hosts.yml"

  container_registry:
    type: "docker-registry"
    storage_backend: "seaweedfs"

  gitops:
    enabled: true
    tool: "flux"
    repository: "github.com/yourorg/cloud-config"

# ============================================================================
# API ENDPOINTS
# ============================================================================

api:
  base_url: "https://api.yourcloud.com"
  version: "v1"

  endpoints:
    # Project Generator
    - path: "/projects"
      methods: ["POST", "GET", "DELETE"]
      auth_required: true
      rate_limit: "100/hour"

    # Compute
    - path: "/vms"
      methods: ["POST", "GET", "DELETE", "PATCH"]
      auth_required: true

    # Storage
    - path: "/buckets"
      methods: ["POST", "GET", "DELETE"]
      auth_required: true

    # Databases
    - path: "/databases"
      methods: ["POST", "GET", "DELETE"]
      auth_required: true

  sdk:
    languages:
      - python
      - javascript
      - go
      - ruby
